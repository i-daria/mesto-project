(()=>{"use strict";var e=document.querySelector(".profile__avatar-container"),t=document.querySelector(".profile__avatar"),n=document.querySelector(".popup-avatar"),r=n.querySelector('form[name="formEditAvatar"]'),o=n.querySelector('button[type="reset"]'),c=document.querySelector(".profile__name"),a=document.querySelector(".profile__profession"),u=document.querySelector(".button_type_edit"),i=document.querySelector(".popup-profile"),l=i.querySelector('form[name="formEditProfile"]'),s=l.querySelector("#userName"),d=l.querySelector("#aboutUser"),f=l.querySelector('button[type="reset"]'),p=document.querySelector(".button_type_add"),m=document.querySelector(".popup-new-place"),y=document.querySelector('form[name="formAddPlace"]'),v=y.querySelector('button[type="reset"]'),h=document.querySelector(".places"),_=document.querySelector("#place").content,S=document.querySelector(".popup_type_gallery"),q=S.querySelector(".button_type_close"),b=S.querySelector(".popup__gallery-image"),k=S.querySelector(".popup__gallery-name"),E={formSelector:".form",inputSelector:".form__input",submitButtonSelecor:".button_type_submit",inputErrorClass:"form__input_invalid",errorClass:"form__input-error_active"},g={baseUrl:"https://nomoreparties.co/v1/plus-cohort-14",headers:{authorization:"1e84654b-bbe2-47d6-b9a3-df2413007526","Content-Type":"application/json"}};function L(e){Array.from(e.querySelectorAll(E.inputSelector)).forEach((function(t){t.addEventListener("input",(function(){!function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.validity.valid?C(n,t):function(e,t){t.classList.add(E.inputErrorClass),e.classList.add(E.errorClass),t.validity.patternMismatch?e.textContent=t.dataset.errorMessage:e.textContent=t.validationMessage}(n,t),j(e)}(e,t)}))})),j(e)}function C(e,t){e.classList.remove(E.errorClass),t.classList.remove(E.inputErrorClass)}function A(e){var t=Array.from(e.querySelectorAll(".".concat(E.errorClass))),n=Array.from(e.querySelectorAll(".".concat(E.inputErrorClass)));if(n.length>0)for(var r=0;r<n.length;r++)C(t[r],n[r])}function j(e){var t=e.querySelector(E.submitButtonSelecor);!function(e){return Array.from(e.querySelectorAll(E.inputSelector)).some((function(e){return!e.validity.valid}))}(e)?t.disabled=!1:t.disabled=!0}function x(e){e.classList.add("popup_opened"),document.addEventListener("keydown",U),e.addEventListener("click",T)}function P(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",U),e.removeEventListener("click",T)}function U(e){"Escape"===e.key&&P(document.querySelector(".popup_opened"))}function T(e){e.target.classList.contains("popup_opened")&&P(document.querySelector(".popup_opened"))}function w(e,t,n){e.textContent=n?"Сохранение...":t}function D(e,t,n){return fetch("".concat(g.baseUrl,"/cards/likes/").concat(t),{method:e,headers:g.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){n.textContent=e.likes.length}))}function N(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,a=O(),u=a.querySelector(".place__image"),i=a.querySelector(".place__like-icon"),l=a.querySelector(".place__like-count");return a.querySelector(".place__name").textContent=e,u.src=t,u.alt=e,l.textContent=n.length,n.forEach((function(e){e._id===o&&i.classList.add("liked")})),r!==o&&(a.querySelector(".place__trash-icon").style.display="none"),J(a,e,t,c),a}function O(){return _.querySelector(".place").cloneNode(!0)}function J(e,t,n,r){e.querySelector(".place__image").addEventListener("click",(function(){b.src=n,b.alt=n,k.textContent=t,x(S)})),e.querySelector(".place__trash-icon").addEventListener("click",(function(){!function(e,t){fetch("".concat(g.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:g.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return t.remove()}))}(r,e)})),e.querySelector(".place__like-icon").addEventListener("click",(function(t){var n=e.querySelector(".place__like-count");!function(e,t,n){e.classList.contains("liked")?D("DELETE",t,n):D("PUT",t,n)}(t.target,r,n),t.target.classList.toggle("liked")}))}e.addEventListener("click",(function(){!function(e){x(e),A(e);var t=e.querySelector(".form");t.reset(),j(t)}(n)})),o.addEventListener("click",(function(){P(n)})),r.addEventListener("submit",(function(e){e.preventDefault();var r,o=e.target.querySelector(".button_type_submit");w(o,"Cохранить",!0),(r=e.target.querySelector("#avatarLink").value,fetch("".concat(g.baseUrl,"/users/me/avatar"),{method:"PATCH",body:JSON.stringify({avatar:"".concat(r)}),headers:g.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){t.setAttribute("src",e.avatar)}))).then((function(e){return w(o,"Cохранить",!1)})).then((function(e){return P(n)}))})),u.addEventListener("click",(function(){var e;x(e=i),function(e){A(e),s.value=c.textContent,d.value=a.textContent}(e),j(e.querySelector(".form"))})),f.addEventListener("click",(function(){P(f.closest(".popup"))})),l.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=e.target.querySelector(".button_type_submit");w(r,"Cохранить",!0),(t=s.value,n=d.value,fetch("".concat(g.baseUrl,"/users/me"),{method:"PATCH",body:JSON.stringify({name:"".concat(t),about:"".concat(n)}),headers:g.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){c.textContent=e.name,a.textContent=e.about}))).then((function(e){return w(r,"Cохранить",!1)})).then((function(e){return P(i)}))})),p.addEventListener("click",(function(){var e;x(e=m),function(e){A(e),y.reset()}(e),j(e.querySelector(".form"))})),v.addEventListener("click",(function(){P(v.closest(".popup"))})),y.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=e.target.querySelector(".button_type_submit");w(r,"Cохранить",!0),(t=e.target.querySelector("#placeName").value,n=e.target.querySelector("#placeLink").value,fetch("".concat(g.baseUrl,"/cards"),{method:"POST",body:JSON.stringify({name:"".concat(t),link:"".concat(n)}),headers:g.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){!function(e,t,n,r,o,c){var a=N(e,t,n,r,o,c);h.prepend(a)}(e.name,e.link,e.likes,e.owner._id,e.owner._id,e._id)}))).then((function(e){return w(r,"Cохранить",!1)})).then((function(e){return P(m)}))})),q.addEventListener("click",(function(e){b.src="#",k.textContent="",P(e.target.closest(".popup"))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),L(e)}))}(E),Promise.all([fetch("".concat(g.baseUrl,"/users/me"),{headers:g.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)})),fetch("".concat(g.baseUrl,"/cards"),{headers:g.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))]).then((function(e){c.textContent=e[0].name,a.textContent=e[0].about,t.setAttribute("src",e[0].avatar);var n=e[0]._id;e[1].forEach((function(e){h.append(N(e.name,e.link,e.likes,e.owner._id,n,e._id))}))})).catch((function(e){return console.log(e)}))})();