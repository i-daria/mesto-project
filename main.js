(()=>{"use strict";var e=document.querySelector(".profile__avatar-container"),t=document.querySelector(".profile__avatar"),n=document.querySelector(".popup-avatar"),r=n.querySelector('form[name="formEditAvatar"]'),o=n.querySelector('button[type="reset"]'),c=document.querySelector(".profile__name"),u=document.querySelector(".profile__profession"),a=document.querySelector(".button_type_edit"),i=document.querySelector(".popup-profile"),l=i.querySelector('form[name="formEditProfile"]'),s=l.querySelector("#userName"),d=l.querySelector("#aboutUser"),f=l.querySelector('button[type="reset"]'),p=document.querySelector(".button_type_add"),y=document.querySelector(".popup-new-place"),m=document.querySelector('form[name="formAddPlace"]'),v=m.querySelector('button[type="reset"]'),h=document.querySelector(".places"),_=document.querySelector("#place").content,S=document.querySelector(".popup_type_gallery"),q=S.querySelector(".button_type_close"),b=S.querySelector(".popup__gallery-image"),g=S.querySelector(".popup__gallery-name"),E={formSelector:".form",inputSelector:".form__input",submitButtonSelecor:".button_type_submit",inputErrorClass:"form__input_invalid",errorClass:"form__input-error_active"},k={baseUrl:"https://nomoreparties.co/v1/plus-cohort-14",headers:{authorization:"1e84654b-bbe2-47d6-b9a3-df2413007526","Content-Type":"application/json"}};function L(e){Array.from(e.querySelectorAll(E.inputSelector)).forEach((function(t){t.addEventListener("input",(function(){!function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.validity.valid?C(n,t):function(e,t){t.classList.add(E.inputErrorClass),e.classList.add(E.errorClass),t.validity.patternMismatch?e.textContent=t.dataset.errorMessage:e.textContent=t.validationMessage}(n,t),x(e)}(e,t)}))})),x(e)}function C(e,t){e.classList.remove(E.errorClass),t.classList.remove(E.inputErrorClass)}function A(e){var t=Array.from(e.querySelectorAll(".".concat(E.errorClass))),n=Array.from(e.querySelectorAll(".".concat(E.inputErrorClass)));if(n.length>0)for(var r=0;r<n.length;r++)C(t[r],n[r])}function x(e){var t=e.querySelector(E.submitButtonSelecor);!function(e){return Array.from(e.querySelectorAll(E.inputSelector)).some((function(e){return!e.validity.valid}))}(e)?t.disabled=!1:t.disabled=!0}function U(e){e.classList.add("popup_opened"),document.addEventListener("keydown",T),e.addEventListener("click",w)}function P(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",T),e.removeEventListener("click",w)}function T(e){"Escape"===e.key&&P(document.querySelector(".popup_opened"))}function w(e){e.target.classList.contains("popup_opened")&&P(document.querySelector(".popup_opened"))}function D(e,t,n){e.textContent=n?"Сохранение...":t}function N(e,t){return fetch("".concat(k.baseUrl,"/cards/likes/").concat(t),{method:e,headers:k.headers}).then((function(e){return O(e)}))}function O(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function j(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,u=J(),a=u.querySelector(".place__image"),i=u.querySelector(".place__like-icon"),l=u.querySelector(".place__like-count");return u.querySelector(".place__name").textContent=e,a.src=t,a.alt=e,l.textContent=n.length,n.forEach((function(e){e._id===o&&i.classList.add("liked")})),r!==o&&(u.querySelector(".place__trash-icon").style.display="none"),M(u,e,t,c),u}function J(){return _.querySelector(".place").cloneNode(!0)}function M(e,t,n,r){e.querySelector(".place__image").addEventListener("click",(function(){b.src=n,b.alt=n,g.textContent=t,U(S)})),e.querySelector(".place__trash-icon").addEventListener("click",(function(){(function(e,t){return fetch("".concat(k.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:k.headers}).then((function(e){return O(e)}))})(r).then((function(t){return e.remove()})).catch((function(e){return console.log(e)}))})),e.querySelector(".place__like-icon").addEventListener("click",(function(t){var n=e.querySelector(".place__like-count");!function(e,t,n){e.classList.contains("liked")?N("DELETE",t).then((function(e){return n.textContent=e.likes.length})).then((function(t){return e.classList.toggle("liked")})).catch((function(e){return console.log(e)})):N("PUT",t).then((function(e){return n.textContent=e.likes.length})).then((function(t){return e.classList.toggle("liked")})).catch((function(e){return console.log(e)}))}(t.target,r,n)}))}e.addEventListener("click",(function(){!function(e){U(e),A(e);var t=e.querySelector(".form");t.reset(),x(t)}(n)})),o.addEventListener("click",(function(){P(n)})),r.addEventListener("submit",(function(e){e.preventDefault();var r,o=e.target.querySelector(".button_type_submit");D(o,"Cохранить",!0),(r=e.target.querySelector("#avatarLink").value,fetch("".concat(k.baseUrl,"/users/me/avatar"),{method:"PATCH",body:JSON.stringify({avatar:"".concat(r)}),headers:k.headers}).then((function(e){return O(e)}))).then((function(e){return t.setAttribute("src",e.avatar)})).then((function(e){return P(n)})).catch((function(e){return console.log(e)})).finally((function(e){return D(o,"Cохранить",!1)}))})),a.addEventListener("click",(function(){var e;U(e=i),function(e){A(e),s.value=c.textContent,d.value=u.textContent}(e),x(e.querySelector(".form"))})),f.addEventListener("click",(function(){P(f.closest(".popup"))})),l.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=e.target.querySelector(".button_type_submit");D(r,"Cохранить",!0),(t=s.value,n=d.value,fetch("".concat(k.baseUrl,"/users/me"),{method:"PATCH",body:JSON.stringify({name:"".concat(t),about:"".concat(n)}),headers:k.headers}).then((function(e){return O(e)}))).then((function(e){c.textContent=e.name,u.textContent=e.about})).then((function(e){return P(i)})).catch((function(e){return console.log(e)})).finally((function(e){return D(r,"Cохранить",!1)}))})),p.addEventListener("click",(function(){var e;U(e=y),function(e){A(e),m.reset()}(e),x(e.querySelector(".form"))})),v.addEventListener("click",(function(){P(v.closest(".popup"))})),m.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=e.target.querySelector(".button_type_submit");D(r,"Cохранить",!0),(t=e.target.querySelector("#placeName").value,n=e.target.querySelector("#placeLink").value,fetch("".concat(k.baseUrl,"/cards"),{method:"POST",body:JSON.stringify({name:"".concat(t),link:"".concat(n)}),headers:k.headers}).then((function(e){return O(e)}))).then((function(e){return function(e,t,n,r,o,c){var u=j(e,t,n,r,o,c);h.prepend(u)}(e.name,e.link,e.likes,e.owner._id,e.owner._id,e._id)})).then((function(e){return P(y)})).catch((function(e){return console.log(e)})).finally((function(e){return D(r,"Cохранить",!1)}))})),q.addEventListener("click",(function(e){b.src="#",g.textContent="",P(e.target.closest(".popup"))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),L(e)}))}(E),Promise.all([fetch("".concat(k.baseUrl,"/users/me"),{headers:k.headers}).then((function(e){return O(e)})),fetch("".concat(k.baseUrl,"/cards"),{headers:k.headers}).then((function(e){return O(e)}))]).then((function(e){c.textContent=e[0].name,u.textContent=e[0].about,t.setAttribute("src",e[0].avatar);var n=e[0]._id;e[1].forEach((function(e){h.append(j(e.name,e.link,e.likes,e.owner._id,n,e._id))}))})).catch((function(e){return console.log(e)}))})();